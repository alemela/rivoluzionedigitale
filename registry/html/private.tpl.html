<!DOCTYPE html>

<head>
    <title>Pagina di @MATRICOLA@</title>
    <meta charset="utf-8" />

    <style>
        body{
            font-family: Verdana, Geneva, sans-serif;
        }
        .line {
            display: inline-block;
        }
    </style>
</head>

<body>
    <h2>Ciao @NOME@ @COGNOME@! - <a href="/logout">Logout</a></h2>

    <h3>Dati personali</h3>

    <div id="Name">
        <div id="preName" class="line"><b>Nome</b>:</div>
        <div id="zoneName" class="line">@NOME@</div>
        <div id="postName" class="line">&nbsp;<button onclick='openForm("postName","Name","name","23")'>Modifica</button></div>
    </div>
    <div id="infoName"></div>
    <br />

    <div id="Surname">
        <div id="preSurname" class="line"><b>Cognome</b>:</div>
        <div id="zoneSurname" class="line">@COGNOME@</div>
        <div id="postSurname" class="line">&nbsp;<button onclick='openForm("postSurname","Surname","surname","23")'>Modifica</button></div>
    </div>
    <div id="infoSurname"></div>
    <br />

    <b>Matricola</b>: @MATRICOLA@
    <br /><br />

    <h3>Dati funzionali al corso</h3>

    <div id="Blog">
        <div id="preBlog" class="line"><b>Url blog</b>:</div>
        <div id="zoneBlog" class="line">@BLOG@</div>
        <div id="postBlog" class="line">&nbsp;<button onclick='openForm("postBlog","Blog","blog","42")'>Modifica</button></div>
        <div id="exBlog" class="line"><small>&nbsp;es. http://www.example.com</small></div>
    </div>
    <div id="infoBlog"></div>
    <br />

    <div id="Twitter">
        <div id="preTwitter" class="line"><b>Account Twitter</b>:</div>
        <div id="zoneTwitter" class="line">@TWITTER@</div>
        <div id="postTwitter" class="line">&nbsp;<button onclick='openForm("postTwitter","Twitter","twitter","20")'>Modifica</button></div>
        <div id="exTwitter" class="line"><small>&nbsp;es. @NickTwitter</small></div>
    </div>
    <div id="infoTwitter"></div>
    <br />

    <div id="WP">
        <div id="preWP" class="line"><b>Account Wikipedia</b>:</div>
        <div id="zoneWP" class="line">@WIKIPEDIA@</div>
        <div id="postWP" class="line">&nbsp;<button onclick='openForm("postWP","WP","wp","30")'>Modifica</button></div>
        <div id="exWikipedia" class="line"><small>&nbsp;es. Utente:MioNickname</small></div>
    </div>
    <div id="infoWP"></div>
    <br />

    <p>I link relativi a video e post verranno utilizzati per accedere agli elaborati per la valutazione. Variazioni degli stessi in data successiva a quelle di consegna (esposte in <a href="http://rivoluzionedigitale.polito.it/regole">regole</a>) verranno normalmente salvate ma ignorate ai fini della correzione.</p>
    <p>I post non vengono salvati ogni volta che aggiornate questa pagina, ma
       possono essere salvati prima della scadenza e vengono in ogni caso
       comunque salvati (molto poco) dopo la scadenza. Di conseguenza, non
       preoccupatevi se, prima della scadenza, i link al vostro post
       fanno riferimento a una versione precedente del post stesso.</p>
    <br>

    <div id="Video">
        <div id="preVideo" class="line"><b>Video</b>:</div>
        <div id="zoneVideo" class="line">@VIDEO@</div>
        <div id="postVideo" class="line">&nbsp;<button onclick='openForm("postVideo","Video","video","42")'>Modifica</button></div>
        <div id="exVideo" class="line"><small>&nbsp;es. https://www.youtube.com/watch?v=aui6NoM56_k</small></div>
    </div>
    <div id="infoVideo"></div>
    <br />

    <div id="Post1">
        <div id="prePost1" class="line"><b>Post n°1</b>:</div>
        <div id="zonePost1" class="line">@POST1@</div>
        <div id="postPost1" class="line">&nbsp;<button onclick='openForm("postPost1","Post1","post1","42")'>Modifica</button></div>
        <div id="exPost1" class="line"><small>&nbsp;es. http://mioblog.tumblr.com/primo-post</small></div>
    </div>
    <div id="infoPost1"></div>
    <div id="linkPost1">
        <a href="http://highgarden.polito.it/post/annotate/@MATRICOLA@/1" target="_blank">[vedi annotazioni]</a>
        <a href="http://highgarden.polito.it/post/read/@MATRICOLA@/1" target="_blank">[leggi originale]</a>
        <a href="http://highgarden.polito.it/post/view-source/@MATRICOLA@/1" target="_blank">[vedi-sorgente]</a>
    </div>
    <br />

    <div id="Post2">
        <div id="prePost2" class="line"><b>Post n°2</b>:</div>
        <div id="zonePost2" class="line">@POST2@</div>
        <div id="postPost2" class="line">&nbsp;<button onclick='openForm("postPost2","Post2","post2","42")'>Modifica</button></div>
        <div id="exPost2" class="line"><small>&nbsp;es. http://mioblog.tumblr.com/secondo-post</small></div>
    </div>
    <div id="infoPost2"></div>
    <div id="linkPost2">
        <a href="http://highgarden.polito.it/post/annotate/@MATRICOLA@/2" target="_blank">[vedi annotazioni]</a>
        <a href="http://highgarden.polito.it/post/read/@MATRICOLA@/2" target="_blank">[leggi originale]</a>
        <a href="http://highgarden.polito.it/post/view-source/@MATRICOLA@/2" target="_blank">[vedi-sorgente]</a>
    </div>
    <br />

    <div id="Post3">
        <div id="prePost3" class="line"><b>Post n°3</b>:</div>
        <div id="zonePost3" class="line">@POST3@</div>
        <div id="postPost3" class="line">&nbsp;<button onclick='openForm("postPost3","Post3","post3","42")'>Modifica</button></div>
        <div id="exPost3" class="line"><small>&nbsp;es. http://mioblog.tumblr.com/terzo-post</small></div>
    </div>
    <div id="infoPost3"></div>
    <div id="linkPost3">
        <a href="http://highgarden.polito.it/post/annotate/@MATRICOLA@/3" target="_blank">[vedi annotazioni]</a>
        <a href="http://highgarden.polito.it/post/read/@MATRICOLA@/3" target="_blank">[leggi originale]</a>
        <a href="http://highgarden.polito.it/post/view-source/@MATRICOLA@/3" target="_blank">[vedi-sorgente]</a>
    </div>
    <br />
    <br />

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

    <script type="text/javascript">
        var matricola = "@MATRICOLA@";
        var URL = "^http(|s)://.*$";
        var regexp = {
            "Name": "^[\\sA-Za-z\\\'\\-]+$",
            "Surname": "^[\\sA-Za-z\\\'\\-]+$",
            "Blog": URL,
            "Twitter": "^(|@[A-Za-z0-9_]{1,15})$",
            "WP": "^(U|u)tente:[^\\{\\}\\[\\]\\#\\|\\<]+)$",
            "Video": URL,
            "Post1": URL,
            "Post2": URL,
            "Post3": URL
        };
        var emptyMsg = {
            "Blog": "Url blog non presente.",
            "Twitter": "Account Twitter non presente.",
            "WP": "Account Wikipedia non presente.",
            "Video": "Url video non presente.",
            "Post1": "Url del primo post non presente.",
            "Post2": "Url del secondo post non presente.",
            "Post3": "Url del terzo post non presente."
        };

        for (key in emptyMsg) {
            if ((document.getElementById("zone"+key).innerHTML === "undefined") || ($("#zone"+key).is(":empty"))) {
                document.getElementById("zone"+key).innerHTML = emptyMsg[key];
            }
        }

        function cancelForm(zone,id,nameid,num,memo) {
            document.getElementById(zone).innerHTML =
                '&nbsp;<button onclick=\'openForm(\"'+zone+'\",\"'+id+'\",\"'+nameid+'\",\"'+num+'\")\'>Modifica</button>';
            document.getElementById("zone"+id).innerHTML = memo;
        }

        function openForm(zone,id,nameid,num) {
            var memo = document.getElementById("zone"+id).innerHTML;
            var memoMod = memo.replace(/^/g, '"');
            memoMod = memoMod.replace(/$/g, '"');
            document.getElementById(zone).innerHTML =
                '<form id=' + id + ' method="post"><input type="text" name=' + nameid + ' id=' + nameid + ' value=' + memoMod + ' pattern=' + regexp[id] + ' size=' + num + '>&nbsp;<button onclick=\'cancelForm(\"' + zone + '\",\"' + id + '\",\"' + nameid + '\",\"' + num + '\",\"' + memo + '\")\'> Annulla </button>&nbsp;<input type="submit" value="Modifica"></form >';
            document.getElementById("zone"+id).innerHTML = "";
        }


        $("#WP").bind("submit", function (evt) {
            var wikipedia = $("#wp").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Wikipedia: wikipedia
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postWP","WP","wp","30",data.Wikipedia);
                    $("#infoWP").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoWP").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });


        $("#Blog").bind("submit", function (evt) {
            var blog = $("#blog").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Blog: blog
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postBlog","Blog","blog","42",data.Blog);
                    $("#infoBlog").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoBlog").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });


        $("#Twitter").bind("submit", function (evt) {
            var twitter = $("#twitter").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Twitter: twitter
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postTwitter","Twitter","twitter","20",data.Twitter);
                    $("#infoTwitter").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoTwitter").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });


        $("#Video").bind("submit", function (evt) {
            var video = $("#video").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Video: video
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postVideo","Video","video","42",data.Video);
                    $("#infoVideo").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoVideo").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });

        $("#Post1").bind("submit", function (evt) {
            var post1 = $("#post1").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Post1: post1
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postPost1","Post1","post1","42",data.Post1);
                    $("#infoPost1").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoPost1").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });

        $("#Post2").bind("submit", function (evt) {
            var post2 = $("#post2").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Post2: post2
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postPost2","Post2","post2","42",data.Post2);
                    $("#infoPost2").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoPost2").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });

        $("#Post3").bind("submit", function (evt) {
            var post3 = $("#post3").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Post3: post3
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postPost3","Post3","post3","42",data.Post3);
                    $("#infoPost3").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoPost3").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });

        $("#Name").bind("submit", function (evt) {
            var nome = $("#name").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Nome: nome
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postName","Name","name","23",data.Nome);
                    $("#infoName").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoName").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });

        $("#Surname").bind("submit", function (evt) {
            var cognome = $("#surname").val();
            $.ajax({
                url: "/mod_sent",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Matricola: matricola,
                    Cognome: cognome
                }),
                success: function (data, textStatus, jqXHR) {
                    cancelForm("postSurname","Surname","surname","23",data.Cognome);
                    $("#infoSurname").html("");
                },
                error: function (jqXHR, textStatus,
                    errorThrown) {
                    $("#infoSurname").html(
                        "<b>Si e' verificato un errore.</b>");
                }
            });
            return false;
        });

    </script>

</body>

</html>
